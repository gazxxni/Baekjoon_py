name: Update Blog Post to Another Repo
on:
  push:
    branches:
      - main
    paths:
      - 'auto_upload/**'  # auto_upload 폴더 변경 시 1111
      - 'blog_posts/**'   # blog_posts 폴더 변경 시 (my_local 처리용)

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source Repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Git 히스토리 전체 가져오기 (커밋 날짜 확인용)
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      
      - name: Install Dependencies
        run: |
          pip install requests beautifulsoup4 openai
      
      - name: Run Converter Script
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python convert.py
      
      - name: Check if blog_posts exists
        id: check_folder
        run: |
          if [ -d "blog_posts" ] && [ "$(ls -A blog_posts)" ]; then
            echo "has_posts=true" >> $GITHUB_OUTPUT
          else
            echo "has_posts=false" >> $GITHUB_OUTPUT
          fi
      
      - name: Pushes to Blog Repository
        if: steps.check_folder.outputs.has_posts == 'true'
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
        with:
          source-directory: 'blog_posts'
          destination-github-username: 'gazxxni'
          destination-repository-name: 'gazxxni.github.io'
          user-email: 'action@github.com'
          target-branch: 'main'
          target-directory: '_posts'
